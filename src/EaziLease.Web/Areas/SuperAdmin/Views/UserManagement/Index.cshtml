@using EaziLease.Web.ViewModels
@model IEnumerable<UserViewModel>

@{
    ViewData["Title"] = "Identity Management";
}

<style>
    /* Table Rows as 'Data Strips' */
    .user-row {
        background: rgba(30, 41, 59, 0.4);
        border: 1px solid #334155;
        transition: all 0.2s ease;
    }
    .user-row:hover {
        background: rgba(30, 41, 59, 0.8);
        border-color: #475569;
    }

    /* Custom Badges */
    .role-pill {
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.7rem;
        background: #1e293b;
        color: #94a3b8;
        border: 1px solid #334155;
        padding: 2px 8px;
        border-radius: 4px;
    }

    .elevate-active {
        color: #f59e0b;
        border-color: #f59e0b;
        background: rgba(245, 158, 11, 0.05);
    }

    /* Action Buttons Styling */
    .btn-command {
        background: transparent;
        border: 1px solid #334155;
        color: #94a3b8;
        font-size: 0.75rem;
        transition: all 0.2s;
    }
    .btn-command:hover {
        border-color: #94a3b8;
        color: #fff;
    }
</style>

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-white mb-0">Identity Control Matrix</h2>
            <p class="text-muted small">Managing @Model.Count() authorized personnel accounts</p>
        </div>
        <a asp-action="Create" asp-controller="UserManagement" class="btn btn-warning fw-bold px-4">
            <i class="fas fa-user-plus me-2"></i>Provision New User
        </a>
    </div>

    <div class="table-responsive">
        <table class="table text-white align-middle border-0">
            <thead class="text-muted small text-uppercase">
                <tr>
                    <th class="border-0">Security Principal</th>
                    <th class="border-0">Authorized Roles</th>
                    <th class="border-0">Elevation Status</th>
                    <th class="border-0 text-end">System Commands</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model)
                {
                    <tr class="user-row">
                        <td class="py-3 ps-3">
                            <div class="d-flex align-items-center">
                                <div class="bg-dark text-warning p-2 rounded-3 me-3 border border-secondary">
                                    <i class="fas fa-fingerprint"></i>
                                </div>
                                <div>
                                    <div class="fw-bold text-white">@user.FullName</div>
                                    <div class="small text-muted font-monospace">@user.Email</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            @foreach (var role in user.Roles)
                            {
                                <span class="role-pill me-1">@role</span>
                            }
                        </td>
                        <td>
                            @if (user.CanElevate)
                            {
                                <span class="role-pill elevate-active">
                                    <i class="fas fa-shield-alt me-1"></i> CANDIDATE
                                </span>
                            }
                            else
                            {
                                <span class="role-pill opacity-50">STANDARD</span>
                            }
                        </td>
                        <td class="text-end pe-3">
                            <div class="d-flex justify-content-end gap-2">
                                <form asp-action="ResetPassword" asp-route-id="@user.Id" method="post" 
                                      onsubmit="return confirm('Initiate remote password reset?');">
                                    <button type="submit" class="btn btn-command" title="Reset Credentials">
                                        <i class="fas fa-key"></i>
                                    </button>
                                </form>

                                <form asp-action="ToggleElevate" asp-route-id="@user.Id" method="post">
                                    <button type="submit" class="btn btn-command @(user.CanElevate ? "text-warning border-warning" : "")" 
                                            title="@(user.CanElevate ? "Revoke Elevation" : "Grant Elevation")">
                                        <i class="fas @(user.CanElevate ? "fa-unlock" : "fa-lock")"></i>
                                    </button>
                                </form>

                                <a asp-action="Edit" asp-route-id="@user.Id" class="btn btn-command" title="Modify Record">
                                    <i class="fas fa-edit"></i>
                                </a>

                                <form asp-action="Delete" asp-route-id="@user.Id" method="post" 
                                      onsubmit="return confirm('PERMANENTLY REMOVE USER?');">
                                    <button type="submit" class="btn btn-command text-danger" title="Purge Account">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>