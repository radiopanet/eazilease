@model IEnumerable<EaziLease.Models.AuditLogs>

@{
    ViewData["Title"] = "System Ledger";
}

<style>
    .ledger-table {
        border-collapse: separate;
        border-spacing: 0 4px;
    }
    .ledger-row {
        background: rgba(30, 41, 59, 0.4);
        border: 1px solid #334155;
        transition: all 0.2s;
    }
    .ledger-row:hover {
        background: rgba(30, 41, 59, 0.7);
        border-color: #475569;
    }
    .mono-text {
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.85rem;
    }
    .action-badge {
        font-size: 0.65rem;
        font-weight: 800;
        padding: 4px 8px;
        border-radius: 4px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    /* Severity Colors */
    .action-create { background: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid #10b981; }
    .action-update { background: rgba(59, 130, 246, 0.1); color: #3b82f6; border: 1px solid #3b82f6; }
    .action-delete { background: rgba(225, 29, 72, 0.1); color: #e11d48; border: 1px solid #e11d48; }
    .action-elevation { background: rgba(245, 158, 11, 0.1); color: #f59e0b; border: 1px solid #f59e0b; }
    
    .ip-address {
        color: #64748b;
        font-size: 0.75rem;
    }
</style>

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-white mb-0">System Audit Ledger</h2>
            <p class="text-muted small">Immutable record of all high-privilege operations</p>
        </div>
        <div>
            <a asp-area="SuperAdmin" asp-action="Index" asp-controller="SuperDashboard" class="btn btn-outline-warning btn-sm fw-bold px-3">
                <i class="fas fa-terminal me-2"></i>Back to Terminal
            </a>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table ledger-table text-white align-middle border-0">
            <thead class="text-muted small text-uppercase">
                <tr>
                    <th class="ps-3 border-0">Timestamp</th>
                    <th class="border-0">Principal</th>
                    <th class="border-0">Operation</th>
                    <th class="border-0">Resource Target</th>
                    <th class="border-0">Telemetry Details</th>
                    <th class="border-0 text-end pe-3">Source IP</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var log in Model)
                {
                    // Logic for choosing badge class
                    string actionClass = log.Action.ToLower() switch {
                        "create" => "action-create",
                        "delete" => "action-delete",
                        "elevate" => "action-elevation",
                        "elevation" => "action-elevation",
                        _ => "action-update"
                    };

                    <tr class="ledger-row">
                        <td class="ps-3 py-3">
                            <div class="mono-text text-info">@log.PerformedAt.ToString("yyyy-MM-dd")</div>
                            <div class="small opacity-50">@log.PerformedAt.ToString("HH:mm:ss")</div>
                        </td>
                        <td>
                            <div class="fw-bold small">@log.PerformedBy</div>
                        </td>
                        <td>
                            <span class="action-badge @actionClass">@log.Action</span>
                        </td>
                        <td>
                            <div class="small">@log.EntityType</div>
                            <div class="mono-text opacity-50" style="font-size: 0.7rem;">ID: #@log.EntityId</div>
                        </td>
                        <td style="max-width: 300px;">
                            <div class="small text-muted text-truncate" title="@log.Details">
                                @(log.Details ?? "---")
                            </div>
                        </td>
                        <td class="text-end pe-3">
                            <span class="ip-address mono-text">
                                <i class="fas fa-network-wired me-1 small"></i>
                                @(log.IpAddress ?? "0.0.0.0")
                            </span>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>